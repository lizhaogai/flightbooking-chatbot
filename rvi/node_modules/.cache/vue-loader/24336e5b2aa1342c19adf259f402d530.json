{"remainingRequest":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/src/components/VoiceFooter.vue?vue&type=style&index=0&id=b893d626&lang=scss&scoped=true&","dependencies":[{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/src/components/VoiceFooter.vue","mtime":1577442544062},{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/alessio/Files/Universita/Magistrale/AI/SHRI/flightbooking-chatbot/rasa-voice-interface/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#app footer {\n\tmargin-top: 30px;\n\tbackground: #fff;\n\tposition: relative;\n\tbottom: 32px;\n\twidth: 100%;\n\theight: calc(#{$footerSize} + 10px);\n\tpadding-bottom: 0;\n\t/* border-top: 3px solid #eee; */\n\tz-index: 3;\n\n\t&.active {\n\t\tdisplay: block;\n\t}\n\n\t.container-fluid {\n\t\theight: 100%;\n\t\tbackground: #f3f7fb;\n\t\twidth: calc(100% - 30px);\n\t\tborder-radius: 32px;\n\t}\n\t.start-button {\n\t\tfont-size: 11pt;\n\t\tcolor: #fff;\n\t\tposition: absolute;\n\t\ttop: -37.5px;\n\t\tleft: calc(50% - 37.5px);\n\t\twidth: 75px;\n\t\theight: 75px;\n\t\tborder-radius: 37.5px;\n\t\tborder: none;\n\t\tbox-shadow: -10px -10px 15px rgba(123, 1, 188, 1) inset,\n\t\t\t-1px -1px 15px rgba(0, 0, 0, 0.8);\n\t\tbackground: rgb(187,133,216);\n\t\tbackground: -moz-linear-gradient(151deg, rgba(187,133,216,1) 0%, rgba(123,1,188,1) 89%);\n\t\tbackground: -webkit-linear-gradient(151deg, rgba(187,133,216,1) 0%, rgba(123,1,188,1) 89%);\n\t\tbackground: linear-gradient(151deg, rgba(187,133,216,1) 0%, rgba(123,1,188,1) 89%);\n\t\tfilter: progid:DXImageTransform.Microsoft.gradient(\n\t\t\tstartColorstr=\"#bb85d8\",\n\t\t\tendColorstr=\"#7b01bc\",\n\t\t\tGradientType=1\n\t\t);\n\t}\n\t.micro-icon{\n\t\twidth: 30px;\n\t\theight: 30px;\n\t}\n\n\t#sound-visualizer{\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 300px;\n\t\ttop: -300px;\n\t}\n}\n",{"version":3,"sources":["VoiceFooter.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VoiceFooter.vue","sourceRoot":"src/components","sourcesContent":["<template>\n\t<!-- Footer: Input field + button -->\n\t<footer>\n\t\t<audio class=\"sound-clips\"></audio>\n\t\t<canvas id=\"sound-visualizer\" width=\"100%\" height=\"300px\">\n\t\t</canvas>\n\t\t<transition name=\"fade\" mode=\"out-in\">\n\t\t\t<div v-if=\"chatStart && !isRecording\">\n\t\t\t\t<button class=\"start-button btn\" :disabled=\"disableRecording\" @click=\"startRecord()\">\n\t\t\t\t\t<font-awesome-icon icon=\"microphone\" class=\"micro-icon\"/>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</transition>\n\t\t<transition name=\"fade\" mode=\"out-in\">\n\t\t\t<div v-if=\"!chatStart\">\n\t\t\t\t<button class=\"start-button btn\" @click=\"startChat()\">START</button>\n\t\t\t</div>\n\t\t</transition>\n\t\t<transition name=\"fade\" mode=\"out-in\">\n\t\t\t<div v-if=\"chatStart && isRecording\">\n\t\t\t\t<button class=\"start-button btn\" @click=\"stopRecording()\">PAUSE</button>\n\t\t\t</div>\n\t\t</transition>\n\t</footer>\n</template>\n\n<script>\n/* eslint-disable no-unused-vars */\n/* Helpers */\nimport { mapGetters, mapState } from 'vuex';\n/* Mixins */\nimport MessageHandlerMixin from '../mixins/MessageHandlerMixin';\n\nimport '@/assets/lib/vad';\n\nexport default {\n\tname: 'Footer',\n\tmixins: [MessageHandlerMixin],\n\tdata() {\n\t\treturn {\n\t\t\taudioContext: undefined,\n\t\t\tmediaRecorder: {},\n\t\t\tisRecording: false,\n\t\t\tdataArray: [],\n\t\t\tanalyser: undefined,\n\t\t\tcanvas: undefined,\n\t\t\tctx: undefined,\n\t\t\tcanvasHeight: undefined,\n\t\t\tcanvasWidth: undefined,\n\t\t\tcountFrame: 0,\n\t\t\trecordTime: undefined\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters(['chatStart', 'inputVisible', 'currentMessage', 'waitForResponse']),\n\t\t...mapState(['incomeMessage', 'disableRecording']),\n\t\treadyToRecord() {\n\t\t\tconsole.log('computed');\n\t\t\tif (this.waitForRespose && this.incomeMessage.length === 1) { return true; }\n\t\t\treturn false;\n\t\t}\n\t},\n\t// watch: {\n\t// \twaitForResponse(value) {\n\t// \t\tconsole.log('watch');\n\t// \t\tconsole.log(value);\n\t// \t\tconsole.log(this.currentMessage.in.length);\n\t// \t\tif (!value && this.currentMessage.in.length === 1) {\n\t// \t\t\tthis.mediaRecorder.start();\n\t// \t\t\tthis.isRecording = true;\n\t// \t\t}\n\t// \t}\n\t// },\n\tmounted() {\n\t\t// init canvas\n\t\tthis.canvas = document.getElementById('sound-visualizer');\n\t\tthis.ctx = this.canvas.getContext('2d');\n\t\tthis.canvasHeight = this.canvas.scrollHeight;\n\t\tthis.canvasWidth = this.canvas.scrollWidth;\n\t},\n\tmethods: {\n\t\tstartChat() {\n\t\t\tthis.$store.commit('setChatStart', true);\n\t\t\t// this.startRecord();\n\t\t},\n\t\tstartRecord() {\n\t\t\tconst vm = this;\n\t\t\twindow.AudioContext = window.AudioContext || window.webkitAudioContext;\n\t\t\tthis.audioContext = new AudioContext({ sampleRate: 16000 });\n\t\t\tthis.isRecording = true;\n\t\t\t// Ask for audio device\n\t\t\tnavigator.getUserMedia = navigator.getUserMedia\n\t\t\t\t|| navigator.mozGetUserMedia\n\t\t\t\t|| navigator.webkitGetUserMedia;\n\t\t\tnavigator.getUserMedia({ audio: true }, vm.startUserMedia, e => {\n\t\t\t\tconsole.log(`No live audio input in this browser: ${e}`);\n\t\t\t});\n\t\t},\n\t\tstopRecording() {\n\t\t\tthis.isRecording = false;\n\t\t\tthis.audioContext.close().then(() => {\n\t\t\t\tconsole.log('streaming close');\n\t\t\t});\n\t\t},\n\t\tstartUserMedia(stream) {\n\t\t\tconst vm = this;\n\t\t\tvm.analyser = vm.audioContext.createAnalyser();\n\t\t\tconst source = vm.audioContext.createMediaStreamSource(stream).connect(vm.analyser);\n\t\t\tconsole.log(vm.analyser);\n\t\t\tvm.dataArray = new Uint8Array(vm.analyser.fftSize / 32);\n\t\t\tvm.animate();\n\t\t\tconst chunks = [];\n\t\t\tconst audioOptions = {\n\t\t\t\taudioBitsPerSecond: 16000\n\t\t\t};\n\t\t\t/*         This two lines using Mediarecorder            */\n\t\t\t// vm.mediaRecorder = new MediaRecorder(stream, audioOptions);\n\t\t\t// vm.mediaRecorder.start();\n\t\t\tvm.mediaRecorder = new Recorder(source, { numChannels: 1 });\n\t\t\tvm.mediaRecorder.record();\n\t\t\twindow.setTimeout(() => {\n\t\t\t\tif (vm.mediaRecorder.state === 'recording') {\n\t\t\t\t\tvm.mediaRecorder.stop();\n\t\t\t\t\tconsole.log('10 seconds, stop recording');\n\t\t\t\t}\n\t\t\t}, 10000);\n\t\t\t// Setup options\n\t\t\tconst options = {\n\t\t\t\tsource: source,\n\t\t\t\tvoice_stop: function() {\n\t\t\t\t\t/*         This line using Mediarecorder            */\n\t\t\t\t\t// if (vm.mediaRecorder.state === 'recording') {\n\t\t\t\t\tif (vm.isRecording) {\n\t\t\t\t\t\tvm.mediaRecorder.stop();\n\t\t\t\t\t\tvm.mediaRecorder.exportWAV(vm.createFileLink);\n\t\t\t\t\t\tvm.stopRecording();\n\t\t\t\t\t\tconsole.log('voice_stop');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tvoice_start: function() {\n\t\t\t\t\tif (vm.isRecording) {\n\t\t\t\t\t\tconsole.log('voice_start');\n\t\t\t\t\t// } else if (!vm.isRecording && (this.incomeMessage.length === 0)) {\n\t\t\t\t\t// \tconsole.log('StartRecording');\n\t\t\t\t\t// \tvm.startRecord();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t// Create VAD\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tconst vad = new VAD(options);\n\n\t\t\t/*              BELOW ARE USING MEDIARECORDER             */\n\t\t\t// Store sound in datas\n\t\t\t// this.mediaRecorder.ondataavailable = function(e) {\n\t\t\t// \tchunks.push(e.data);\n\t\t\t// };\n\n\t\t\t// this.mediaRecorder.onstop = function(e) {\n\t\t\t// \tconsole.log('recorder stopped');\n\t\t\t// \tvm.$store.commit('setResponseStatus', true);\n\t\t\t// \tthis.waitForRespose = true;\n\t\t\t// \tconst blob = new Blob(chunks, { type: 'audio/ogg;codecs=0' });\n\t\t\t// \tchunks = [];\n\t\t\t// \tconst audioURL = window.URL.createObjectURL(blob);\n\n\t\t\t// \tconst request = new XMLHttpRequest();\n\t\t\t// \trequest.open('GET', audioURL, true);\n\t\t\t// \trequest.responseType = 'blob';\n\t\t\t// \trequest.onload = function() {\n\t\t\t// \t\tconst reader = new FileReader();\n\t\t\t// \t\treader.readAsDataURL(request.response);\n\t\t\t// \t\treader.onload = function(el) {\n\t\t\t// \t\t\tconsole.log('DataURL:', el.target.result);\n\t\t\t// \t\t\tvm.sendMessageToBot(el.target.result);\n\t\t\t// \t\t};\n\t\t\t// \t};\n\t\t\t// \trequest.send();\n\t\t\t// };\n\t\t},\n\t\tcreateFileLink(blob) {\n\t\t\tconst vm = this;\n\t\t\tconsole.log('recorder stopped');\n\t\t\tvm.$store.commit('setResponseStatus', true);\n\t\t\tthis.waitForRespose = true;\n\t\t\tconst audioURL = window.URL.createObjectURL(blob);\n\n\t\t\tconst request = new XMLHttpRequest();\n\t\t\trequest.open('GET', audioURL, true);\n\t\t\trequest.responseType = 'blob';\n\t\t\trequest.onload = function() {\n\t\t\t\tconst reader = new FileReader();\n\t\t\t\treader.readAsDataURL(request.response);\n\t\t\t\treader.onload = function(el) {\n\t\t\t\t\t// console.log('DataURL:', el.target.result);\n\t\t\t\t\tconsole.log('SEND RESULT TO THE BOT');\n\t\t\t\t\tvm.sendMessageToBot(el.target.result);\n\t\t\t\t};\n\t\t\t};\n\t\t\trequest.send();\n\t\t},\n\t\tplayMedia(audioPath) {\n\t\t\tconst audio = document.querySelector('.sound-clips');\n\t\t\taudio.setAttribute('controls', '');\n\t\t\taudio.setAttribute('autoplay', '');\n\t\t\taudio.src = audioPath;\n\t\t},\n\t\tanimate() {\n\t\t\tthis.ctx.globalAlpha = 0.5;\n\t\t\tif (this.countFrame > 90) {\n\t\t\t\tthis.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n\t\t\t\tthis.countFrame = 0;\n\t\t\t}\n\t\t\tthis.analyser.getByteFrequencyData(this.dataArray);\n\t\t\tthis.ctx.strokeStyle = '#fff';\n\t\t\t// this.ctx.lineWidth = 0.5;\n\t\t\tthis.ctx.beginPath();\n\t\t\tthis.ctx.moveTo(-2, this.canvasHeight / 2);\n\t\t\tconst arrayLength = this.dataArray.length;\n\t\t\tconst countStep = this.canvasWidth / arrayLength;\n\n\t\t\tfor (let i = 1; i < arrayLength - 2; i += 1) {\n\t\t\t\tconst points = [];\n\t\t\t\tpoints[0] = {\n\t\t\t\t\tx: i * countStep,\n\t\t\t\t\ty: (this.canvasHeight - this.dataArray[i]) / 2\n\t\t\t\t};\n\t\t\t\tpoints[1] = {\n\t\t\t\t\tx: (i + 1) * countStep,\n\t\t\t\t\ty: (this.canvasHeight - this.dataArray[i + 1]) / 2\n\t\t\t\t};\n\t\t\t\tconst xc = (points[0].x + points[1].x) / 2;\n\t\t\t\tconst yc = (points[0].y + points[1].y) / 2;\n\t\t\t\tthis.ctx.quadraticCurveTo(points[0].x, points[0].y, xc, yc);\n\t\t\t}\n\t\t\tthis.ctx.stroke();\n\t\t\tthis.countFrame += 1;\n\t\t\twindow.requestAnimationFrame(this.animate);\n\t\t}\n\t}\n};\n</script>\n\n<style lang=\"scss\" scoped>\n#app footer {\n\tmargin-top: 30px;\n\tbackground: #fff;\n\tposition: relative;\n\tbottom: 32px;\n\twidth: 100%;\n\theight: calc(#{$footerSize} + 10px);\n\tpadding-bottom: 0;\n\t/* border-top: 3px solid #eee; */\n\tz-index: 3;\n\n\t&.active {\n\t\tdisplay: block;\n\t}\n\n\t.container-fluid {\n\t\theight: 100%;\n\t\tbackground: #f3f7fb;\n\t\twidth: calc(100% - 30px);\n\t\tborder-radius: 32px;\n\t}\n\t.start-button {\n\t\tfont-size: 11pt;\n\t\tcolor: #fff;\n\t\tposition: absolute;\n\t\ttop: -37.5px;\n\t\tleft: calc(50% - 37.5px);\n\t\twidth: 75px;\n\t\theight: 75px;\n\t\tborder-radius: 37.5px;\n\t\tborder: none;\n\t\tbox-shadow: -10px -10px 15px rgba(123, 1, 188, 1) inset,\n\t\t\t-1px -1px 15px rgba(0, 0, 0, 0.8);\n\t\tbackground: rgb(187,133,216);\n\t\tbackground: -moz-linear-gradient(151deg, rgba(187,133,216,1) 0%, rgba(123,1,188,1) 89%);\n\t\tbackground: -webkit-linear-gradient(151deg, rgba(187,133,216,1) 0%, rgba(123,1,188,1) 89%);\n\t\tbackground: linear-gradient(151deg, rgba(187,133,216,1) 0%, rgba(123,1,188,1) 89%);\n\t\tfilter: progid:DXImageTransform.Microsoft.gradient(\n\t\t\tstartColorstr=\"#bb85d8\",\n\t\t\tendColorstr=\"#7b01bc\",\n\t\t\tGradientType=1\n\t\t);\n\t}\n\t.micro-icon{\n\t\twidth: 30px;\n\t\theight: 30px;\n\t}\n\n\t#sound-visualizer{\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 300px;\n\t\ttop: -300px;\n\t}\n}\n</style>\n"]}]}